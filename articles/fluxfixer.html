<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>fluxfixer • fluxfixer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="fluxfixer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fluxfixer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/fluxfixer.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yhata86/fluxfixer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>fluxfixer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yhata86/fluxfixer/blob/main/vignettes/fluxfixer.Rmd" class="external-link"><code>vignettes/fluxfixer.Rmd</code></a></small>
      <div class="d-none name"><code>fluxfixer.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>fluxfixer provides a sophisticated protocol for post-processing raw
time series, which can be applied not only to thermal dissipation sap
flow data but also to other noisy time series, using classic statistical
and machine-learning methods.</p>
<p>This vignette demonstrates how to use the main functions by showing
the actual post-processing of sap flow data observed in Malaysia.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the latest version of fluxfixer from <a href="https://cran.r-project.org/" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"fluxfixer"</span><span class="op">)</span></span></code></pre></div>
<p>Or, you can install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"yhata86/fluxfixer"</span><span class="op">)</span></span></code></pre></div>
<p>Then, load and attach the package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yhata86/fluxfixer" class="external-link">fluxfixer</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>Now you can use various functions in the package. Please check the
demonstration below, consisting of three sections.</p>
<p>The first section shows how to prepare input data suitable for the
whole post-processing protocol. You can learn which variables are needed
for the processes you want to conduct.</p>
<p>The second section explains the way to apply all the processes to the
input data automatically. You will understand which arguments should be
set correctly based on the input data and required processes.</p>
<p>The third section demonstrates how you apply each process
step-by-step to the input data. This will be helpful if you are not
satisfied with the automatic process result and modify the details of
each process.</p>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>To begin with, you need to prepare an input data frame. This
preparation depends on which type of time series you want to
post-process.</p>
<div class="section level4">
<h4 id="for-thermal-dissipation-sap-flow-time-series">For thermal dissipation sap flow time series<a class="anchor" aria-label="anchor" href="#for-thermal-dissipation-sap-flow-time-series"></a>
</h4>
<p>The variables listed in the table below are mandatory for each method
to determine zero-flow conditions (SP: Successive predawn method; PD:
Daily predawn method; MW: Moving window method; DR: Double regression
method; ED: Environmental dependent method).</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="45%">
<col width="25%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">Type</th>
<th align="center">SP</th>
<th align="center">PD</th>
<th align="center">MW</th>
<th align="left">DR</th>
<th align="center">ED</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Timestamp</td>
<td align="left">POSIX.ct or POSIX.lt</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="left">✔</td>
<td align="center">✔</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi><mspace width="0.222em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi></mi><mo>∘</mo></msup><mi mathvariant="normal">C</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta T~(^\circ \mathrm{C})</annotation></semantics></math></td>
<td align="left">Numeric</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="left">✔</td>
<td align="center">✔</td>
</tr>
<tr class="odd">
<td align="left">Global solar radiation (W m<sup>-2</sup>)</td>
<td align="left">Numeric</td>
<td align="center"></td>
<td align="center">✔</td>
<td align="center">✔</td>
<td align="left">✔</td>
<td align="center">✔</td>
</tr>
<tr class="even">
<td align="left">Air temperature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi></mi><mo>∘</mo></msup><mi mathvariant="normal">C</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(^\circ \mathrm{C})</annotation></semantics></math>
</td>
<td align="left">Numeric</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="left"></td>
<td align="center">✔</td>
</tr>
<tr class="odd">
<td align="left">Vapor pressure deficit (hPa)</td>
<td align="left">Numeric</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="left"></td>
<td align="center">✔</td>
</tr>
</tbody>
</table>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
is the temperature difference between sap flow probes. You can select
the multiple methods at once during the automatic processing.</p>
<p>Here are the more details of each variable column.</p>
<ul>
<li><p>Timestamp: A timestamp of class POSIXct or POSIXt, indicating the
timings of the end of each measurement in local time. Any interval
(typically 15 to 60 min) is allowed, but the timestamps must be equally
spaced and arranged chronologically.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>:
A numeric value of the temperature difference between sap flow probes.
The units should be in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mo>∘</mo></msup><mi mathvariant="normal">C</mi></mrow><annotation encoding="application/x-tex">^\circ \mathrm{C}</annotation></semantics></math>.
It is acceptable to include missing values, but the label representing
the missing value must be unique such as <code>-9999</code>.</p></li>
<li><p>Global solar radiation: A numeric value indicating incident
short-wave radiation. The units should be in W m<sup>-2</sup>. If you
choose the PD, MW, DR, or ED methods, the time series must be included
and gap-filled previously. These methods use it only to define daytime,
so you can use PPFD (photosynthetic photon flux density) or another
variable with a strong correlation with global solar radiation. In such
cases, you must modify the threshold value for daytime definition
specified by the argument <code>thres_radi</code> in
<code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> or <code><a href="../reference/calc_dtmax.html">calc_dtmax()</a></code>. In case you
have no radiative time series, this package offers the
<code><a href="../reference/calc_sw_in_toa.html">calc_sw_in_toa()</a></code> function that estimates the global solar
radiation at the top of the atmosphere at a specific location. You can
add this time series to your input data frame and determine the
zero-flow conditions. See more details in
<code>?calc_sw_in_toa()</code>.</p></li>
<li><p>Air temperature: A numeric value and its units should be
in<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mo>∘</mo></msup><mi mathvariant="normal">C</mi></mrow><annotation encoding="application/x-tex">^\circ \mathrm{C}</annotation></semantics></math>.
If you select the ED method, this time series must be included and
gap-filled previously.</p></li>
<li><p>Vapor pressure deficit (VPD): A numeric value representing the
difference between saturated water vapor pressure and the actual partial
water vapor pressure in the atmosphere. The units should be in hPa. If
you select the ED method, this time series must be included and
gap-filled previously. And even if you do not select the ED method, the
VPD is recommended to be included in the input data frame to construct a
more powerful random forest model for outlier detection and gap-filling
processes, as the VPD typically controls the opening of plant stomata.
In this case, you do not have to fill gaps in the time series
previously.</p></li>
<li><p>Other variables: Even when you select only the SP method, you
need to add as many drivers that influence sap flow dynamics as possible
in the input data frame to construct a more powerful random forest model
for outlier detection and gap-filling processes. For example, if you
want to post-process sap flow data observed in a deciduous forest, you
are recommended to include a time series representing forest leaf
amount, such as LAI (leaf area index).</p></li>
</ul>
<p>You can also include columns that are unrelated to the
post-processing, but be sure to indicate which variables are to be used
in the random forest construction when you execute
<code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> by specifying
<code>vctr_colname_feature</code>.</p>
</div>
<div class="section level4">
<h4 id="for-time-series-unrelated-to-thermal-dissipation-sap-flow">For time series unrelated to thermal dissipation sap flow<a class="anchor" aria-label="anchor" href="#for-time-series-unrelated-to-thermal-dissipation-sap-flow"></a>
</h4>
<p>In this case, the input data frame is required to have the columns
below.</p>
<ul>
<li><p>Timestamp: A timestamp of class POSIXct or POSIXt, indicating the
timings of the end of each measurement in local time. Any interval is
allowed, but the timestamps must be equally spaced and arranged
chronologically.</p></li>
<li><p>Target variable: A numeric value of the variable you want to
post-process. It is acceptable to include missing values, but the label
representing the missing value must be unique such as
<code>-9999</code>.</p></li>
<li><p>Other variables: You need to add as many drivers that influence
targeted variable dynamics as possible in the input data frame to
construct a more powerful random forest model for outlier detection and
gap-filling processes.</p></li>
</ul>
<p>You can also include columns that are unrelated to the
post-processing, but be sure to indicate which variables are to be used
in the random forest construction when you execute
<code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> by specifying
<code>vctr_colname_feature</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="automatic-execution-of-all-processes">Automatic execution of all processes<a class="anchor" aria-label="anchor" href="#automatic-execution-of-all-processes"></a>
</h3>
<p>This section shows how to use the function
<code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> by post-processing half-hourly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series observed in Malaysia from Sep. 2012 to Aug. 2013.</p>
<p>Even in the case you want to execute <code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> for
non-sap-flow time series, the process is similar. But you need to set an
argument, <code>skip_sapflow_calc</code>, to <code>TRUE</code> (default
is <code>FALSE</code>), and the function skips the processes specific to
the sap flow data, such as the zero-flow conditions estimation and sap
flux density calculation.</p>
<p>Let’s start by loading the sample data frame.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load sample data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dt_noisy"</span><span class="op">)</span></span></code></pre></div>
<p>This data frame contains the columns below.</p>
<ul>
<li>
<code>time</code>: Timestamp of the measurement end timing in local
time</li>
<li>
<code>dt</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mo>∘</mo></msup><mi mathvariant="normal">C</mi></mrow><annotation encoding="application/x-tex">^\circ \mathrm{C}</annotation></semantics></math>)</li>
<li>
<code>p</code>: Precipitation (mm)</li>
<li>
<code>sw_in</code>: Global solar radiation (W m<sup>-2</sup>)</li>
<li>
<code>ta</code>: Air temperature
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mo>∘</mo></msup><mi mathvariant="normal">C</mi></mrow><annotation encoding="application/x-tex">^\circ \mathrm{C}</annotation></semantics></math>)</li>
<li>
<code>vpd</code>: Vapor pressure deficit (hPa)</li>
<li>
<code>ws</code>: Horizontal wind speed (m s<sup>-1</sup>)</li>
<li>
<code>swc</code>: Soil water content (m^3 m<sup>-3</sup>)}</li>
</ul>
<p>You can check the details of the data frame in
<code>?data("dt_noisy")</code> if necessary. The target column is
<code>dt</code>, so check this time series visually first.</p>
<p><img src="images/README-example_raw-1.png"></p>
<p>Or, you can check the time series in a specific period by the code
below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Just for the visualization</span></span>
<span><span class="co"># install.packages("ggplot2)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Set the period you want to check</span></span>
<span><span class="va">time_head</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2012/09/01 00:30"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span><span class="va">time_tail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/09/01 00:00"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dt_noisy</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,</span>
<span>                              <span class="op">~</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/na_if.html" class="external-link">na_if</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span><span class="fl">9999</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_datetime</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time_head</span>, <span class="va">time_tail</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">dt</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span></span></code></pre></div>
<p>From this visualization, you would come up with some ideas for
post-processing.</p>
<ul>
<li><p>There is a short-term signal drift in May 2013. The short-term
drift correction is needed.</p></li>
<li><p>There is no high-frequency noise contamination throughout the
measurement period. The high-frequency noise filtering is not
required.</p></li>
<li><p>Long-term gradual signal trend exists. Detrending is needed for
preventing the underestimation of sap flux density.</p></li>
<li><p>Signal damping, which means the gradual decrease in signal
standard deviation, did not occur. The signal damping correction is not
required.</p></li>
<li><p>The sap flow sensor was replaced in May 2013, according to the
information from a data provider. The measurement sub-period should be
set.</p></li>
</ul>
<p>Now, you are able to set appropriate arguments in
<code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> and execute it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the period of the short-term drift</span></span>
<span><span class="va">time_drft_head</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/05/14 13:30"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span><span class="va">time_drft_tail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/05/17 15:00"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Specify the sensor replacement timing</span></span>
<span><span class="va">time_prd_tail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/05/14 13:00"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Run all processes automatically</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/run_fluxfixer.html">run_fluxfixer</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">dt_noisy</span>,</span>
<span>                colname_time <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                colname_target <span class="op">=</span> <span class="st">"dt"</span>,</span>
<span>                vctr_time_drft_head <span class="op">=</span> <span class="va">time_drft_head</span>,</span>
<span>                vctr_time_drft_tail <span class="op">=</span> <span class="va">time_drft_tail</span>,</span>
<span>                vctr_time_prd_tail <span class="op">=</span> <span class="va">time_prd_tail</span>,</span>
<span>                detrend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Note that, in the default arguments, this function does not conduct
the short-term drift correction, noise filtering, detrending, or signal
damping correction. Also, only the SP method is applied by default to
estimate zero-flow conditions.</p>
<p>The <code>result</code> data frame contains columns below.</p>
<ul>
<li><p><code>time</code>: The same timestamp as the input timestamp
specified by <code>colname_time</code>.</p></li>
<li><p><code>raw</code>: The same input
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series specified by <code>colname_target</code>.</p></li>
<li><p><code>processed</code>: The post-processed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series</p></li>
<li><p><code>qc</code>: A quality-control (QC) flag time series
indicating the history of modifications to each data point. See more
details in <code><a href="../reference/run_fluxfixer.html">?run_fluxfixer</a></code></p></li>
<li><p><code>dtmax_sp</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
(the maximum temperature difference between sap flow probes under
zero-flow conditions) time series calculated by the SP method.</p></li>
<li><p><code>fd_sp</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi mathvariant="normal">d</mi></msub><annotation encoding="application/x-tex">F_\mathrm{d}</annotation></semantics></math>
(sap flux density) time series using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
calculated by the SP method.</p></li>
</ul>
<p>You can confirm whether this function post-processed the raw time
series appropriately by drawing the graph.</p>
<p><img src="images/README-example_gf-1.png"></p>
<p>The blue and orange points represent the raw and processed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series. The function was able to remove error values and outliers,
correct the short-term drift, fill missing values, and do
detrending.</p>
<p>You can also check the time series in a specific period by the code
below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Set the period you want to check</span></span>
<span><span class="va">time_head</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2012/09/01 00:30"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span><span class="va">time_tail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/09/01 00:00"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,</span>
<span>                              <span class="op">~</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/na_if.html" class="external-link">na_if</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span><span class="fl">9999</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_datetime</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time_head</span>, <span class="va">time_tail</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">raw</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"royalblue"</span>, alpha <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">processed</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>If you want to know what happened in the automated process, let’s
move the following section. You will be able to learn how the raw data
is modified in each process, and use the <code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code>
function or other related functions more flexibly by setting various
arguments appropriately.</p>
</div>
<div class="section level3">
<h3 id="step-by-step-executions-of-each-process">Step-by-step executions of each process<a class="anchor" aria-label="anchor" href="#step-by-step-executions-of-each-process"></a>
</h3>
<div class="section level4">
<h4 id="data-input">Data Input<a class="anchor" aria-label="anchor" href="#data-input"></a>
</h4>
<p>For those who jumped into this section directly, please load the
sample data first.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load sample data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dt_noisy"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s explore the functions deeply that comprise the automated
function, <code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="anomaly-correction">Anomaly correction<a class="anchor" aria-label="anchor" href="#anomaly-correction"></a>
</h4>
<p>To begin with, you remove anomalies and correct the time series. This
process is divided into three procedures: the absolute limit test, the
short-term drift correction, and the high-frequency noise removal.</p>
<div class="section level5">
<h5 id="absolute-limit-test">Absolute limit test<a class="anchor" aria-label="anchor" href="#absolute-limit-test"></a>
</h5>
<p><code><a href="../reference/check_absolute_limits.html">check_absolute_limits()</a></code> removes out-of-range values by
setting lower and upper limits. By default, this function removes the
values less than 3 or more than 50, assuming the input vector is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series. You can set these threshold values according to the
reasonable range of the input time series by specifying
<code>thres_al_min</code> and <code>thres_al_max</code> arguments.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Conduct the absolute limit test</span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dt_noisy</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dt_al <span class="op">=</span> <span class="fu"><a href="../reference/check_absolute_limits.html">check_absolute_limits</a></span><span class="op">(</span>vctr_target <span class="op">=</span> <span class="va">dt</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You got the new column, <code>dt_al</code>, in the data frame. This
column indicates the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series after the out-of-range value removal.</p>
</div>
<div class="section level5">
<h5 id="short-term-drift-correction-optional">Short-term drift correction (optional)<a class="anchor" aria-label="anchor" href="#short-term-drift-correction-optional"></a>
</h5>
<p><code><a href="../reference/modify_short_drift.html">modify_short_drift()</a></code> corrects sudden changes in the
average in the time series over a short period (hours to days) specified
by <code>vctr_time_drft_head</code> and
<code>vctr_time_drft_tail</code>. Multiple short-term drifts can be
corrected at once using this function. This procedure uses a reference
period, defined as the number of days specified by
<code>n_day_ref</code> before and after the occurrence of the anomaly.
Then, the anomalous time series is standardized so that the 5th and 95th
percentile values of the anomalous and reference (non-anomalous) time
series match over this period. These percentile values are used instead
of the maximum and minimum values to ensure robustness against possible
outliers in the original or reference time series.</p>
<p>As indicated in the previous section, the input time series has a
short-term signal drift in May 2013. So, you need to conduct this
optional process.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the period of the short-term drift</span></span>
<span><span class="va">time_drft_head</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/05/14 13:30"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span><span class="va">time_drft_tail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/05/17 15:00"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Conduct the short-term drift correction</span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dt_sdc <span class="op">=</span> <span class="fu"><a href="../reference/modify_short_drift.html">modify_short_drift</a></span><span class="op">(</span>vctr_time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                                            vctr_target <span class="op">=</span> <span class="va">dt_al</span>,</span>
<span>                                            vctr_time_drft_head <span class="op">=</span> <span class="va">time_drft_head</span>,</span>
<span>                                            vctr_time_drft_tail <span class="op">=</span> <span class="va">time_drft_tail</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The column <code>dt_sdc</code> represents the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series after the correction.</p>
</div>
<div class="section level5">
<h5 id="high-frequency-noise-removal-optional">High-frequency noise removal (optional)<a class="anchor" aria-label="anchor" href="#high-frequency-noise-removal-optional"></a>
</h5>
<p><code><a href="../reference/filter_highfreq_noise.html">filter_highfreq_noise()</a></code> filters a time series with a
specific period by convolving it with a Gaussian window, removing
high-frequency noise. The period to be filtered can be specified by
<code>vctr_time_noise</code>. Also, you can modify the shape of the
Gaussian window by <code>wndw_size_noise</code> and
<code>inv_sigma_noise</code> arguments.</p>
<p>For the sample data, there is no high-frequency noise contamination.
So, you do not have to conduct this optional process.</p>
</div>
</div>
<div class="section level4">
<h4 id="outlier-removal">Outlier removal<a class="anchor" aria-label="anchor" href="#outlier-removal"></a>
</h4>
<p>The next step is to remove outliers in the target time series. This
process consists of two procedures: Z-score outlier removal and random
forest outlier removal.</p>
<div class="section level5">
<h5 id="z-score-outlier-removal">Z-score outlier removal<a class="anchor" aria-label="anchor" href="#z-score-outlier-removal"></a>
</h5>
<p><code><a href="../reference/remove_zscore_outlier.html">remove_zscore_outlier()</a></code> detects and removes outliers by
converting an original time series into a Z-score time series using a
moving window.</p>
<p>The Z-score is calculated by subtracting the average from the
original value and dividing it by the standard deviation. The input time
series is standardized using a moving window, and the data values are
converted to Z-scores. In this step, the width of the moving window,
specified by <code>wndw_size_z</code>, is set to 15 days by default,
centered on the target time point, and standardization is performed
individually for each time point in the time series. The upper and lower
limits of the Z-score, specified by <code>thres_z</code> (default: ±5),
are set, and data points outside that range are removed as outliers.
After the outliers have been removed, the Z-score is returned to the
original value using the original mean and standard deviation time
series, and standardization is performed again using a moving window to
remove additional outliers. These procedures are repeated until either
no more outliers are removed or the maximum number of iterations,
specified by <code>n_calc_max</code> (default: 10), is reached.</p>
<p>Users can define sub-periods across the entire time series using
<code>vctr_time_prd_tail</code>, and the Z-score conversion is performed
in each sub-period separately. This separated conversion is useful when
the input time series suddenly changes its nature, such as after a
sensor replacement.</p>
<p>For the sample data process, the sensor replacement occurred in May
2013. So, you are recommended to set the sub-period.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Specify the sensor replacement timing</span></span>
<span><span class="va">time_prd_tail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2013/05/14 13:00"</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT-8"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Conduct the Z-score outlier removal</span></span>
<span><span class="va">df_z</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/remove_zscore_outlier.html">remove_zscore_outlier</a></span><span class="op">(</span>vctr_time <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                        vctr_target <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">dt_sdc</span>,</span>
<span>                        vctr_time_prd_tail <span class="op">=</span> <span class="va">time_prd_tail</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_z</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">z_cleaned</span>, <span class="va">avg_cleaned</span>, <span class="va">sd_cleaned</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">df_all</span>, <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>The column <code>z_cleaned</code> represents the standardized
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series after the Z-score outlier removal.</p>
<p>In some cases, for sap flow measurements, the input
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series may yield a signal that is attenuated for only a short
period, for example, when rainfall continues for days, causing the
moving window mean (or standard deviation) to increase (or decrease). In
such cases, standardization will cause the Z-score time series
immediately before and after the rainfall to be unnaturally distorted,
hindering the construction of the random forest model. If
<code>modify_z</code> is <code>TRUE</code>, after the outlier removal,
this function modifies the Z-score time series for periods when the
moving window average has an upward peak, and the moving window standard
deviation has a downward peak simultaneously. See more details in
<code><a href="../reference/remove_zscore_outlier.html">?remove_zscore_outlier</a></code>.</p>
</div>
<div class="section level5">
<h5 id="random-forest-outlier-removal">Random forest outlier removal<a class="anchor" aria-label="anchor" href="#random-forest-outlier-removal"></a>
</h5>
<p><code><a href="../reference/remove_rf_outlier.html">remove_rf_outlier()</a></code> detects and removes outliers by a
random forest model whose hyperparameters are calibrated using a grid
search approach and out-of-bag evaluation.</p>
<p>A random forest model is constructed for the targeted time series to
remove outliers. The time series is assumed to be stationary, so the
standardized time series is suitable for this process. You can input any
feature from the input data frame, and out-of-bag evaluation is used to
determine the hyperparameters. This evaluation is applied to a training
dataset separated from the entire input data. To reduce the
computational cost, the only hyperparameter used by default for grid
search is the number of candidate features (<code>vctr_m_try</code>). To
reduce the risk of learning noise, the training data sampling ratio,
specified by <code>vctr_subsample_outlier</code>, is set to 0.1 by
default. After determining the optimal hyperparameters, they are used to
construct the optimal random forest model. Output values are obtained
from 500 (default; specified by <code>n_tree</code>) trees, and the
first quartile (Q1), third quartile (Q3), and interquartile range (IQR)
of the output values at each time point are calculated. If the targeted
value is less than Q1 − 1.5IQR or more than Q3 + 1.5IQR (default), the
data point is identified as an outlier and removed. The coefficient 1.5
can be changed by <code>coef_iqr</code>.</p>
<p>The sample data frame contains time series of environmental factors,
including precipitation (<code>p</code>), global solar radiation
(<code>sw_in</code>), air temperature (<code>ta</code>), vapor pressure
deficit (<code>vpd</code>), horizontal wind speed (<code>ws</code>), and
soil water content (<code>swc</code>). Using these drivers, you can
construct a more precise random forest model.</p>
<p>Note that if you do not specify the explanatory variable names in
<code>vctr_colname_feature</code>, all of the columns excluding the
column specified in <code>colname_label</code> are used for the
construction.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Conduct the random forest outlier removal</span></span>
<span><span class="va">df_rf</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/remove_rf_outlier.html">remove_rf_outlier</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_all</span>,</span>
<span>                    colname_label <span class="op">=</span> <span class="st">"z_cleaned"</span>,</span>
<span>                    vctr_colname_feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>, <span class="st">"sw_in"</span>, <span class="st">"ta"</span>, <span class="st">"vpd"</span>, <span class="st">"ws"</span>, <span class="st">"swc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>z_rf <span class="op">=</span> <span class="va">df_rf</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">cleaned</span><span class="op">)</span></span></code></pre></div>
<p>The column <code>z_rf</code> in the <code>df_all</code> data frame
represents the standardized
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series after the random forest outlier removal.</p>
<p>If you want to remove more outliers remaining in the output time
series by visual inspection, consider using
<code><a href="../reference/remove_manually.html">remove_manually()</a></code>. However, manual outlier removal is not
recommended due to its high subjectivity.</p>
<p>Additionally, if you want to conduct signal detrending or damping
correction in the following processes, you need to define the reference
values of the average and standard deviation. Using the cleaned time
series after the two outlier removal processes,
<code><a href="../reference/calc_ref_stats.html">calc_ref_stats()</a></code> determines these reference values by
calculating the median of the statistical values for the first several
days in each sub-period. See more details in
<code><a href="../reference/calc_ref_stats.html">?calc_ref_stats</a></code>.</p>
<p>For the sample data process, you will apply detrending. So, you have
to calculate the reference statistics now. Note that this calculation is
applied to the target time series in its original units, so you need to
convert the cleaned Z-score time series before inputting it to
<code><a href="../reference/calc_ref_stats.html">calc_ref_stats()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate the reference values of average and standard deviation</span></span>
<span><span class="va">vctr_stats_ref</span> <span class="op">&lt;-</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>z_target <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">z_rf</span>,</span>
<span>                   avg_target <span class="op">=</span> <span class="va">df_z</span><span class="op">$</span><span class="va">avg_cleaned</span>,</span>
<span>                   sd_target <span class="op">=</span> <span class="va">df_z</span><span class="op">$</span><span class="va">sd_cleaned</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">z_target</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">9999</span> <span class="op">&amp;</span></span>
<span>                                        <span class="va">avg_target</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">9999</span> <span class="op">&amp;</span></span>
<span>                                        <span class="va">sd_target</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">9999</span>,</span>
<span>                                      <span class="va">z_target</span> <span class="op">*</span> <span class="va">sd_target</span> <span class="op">+</span> <span class="va">avg_target</span>,</span>
<span>                                      <span class="op">-</span><span class="fl">9999</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/calc_ref_stats.html">calc_ref_stats</a></span><span class="op">(</span>vctr_time <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                       vctr_target <span class="op">=</span> <span class="va">.</span>,</span>
<span>                       vctr_time_prd_tail <span class="op">=</span> <span class="va">time_prd_tail</span><span class="op">)</span></span></code></pre></div>
<p><code>vctr_stats_ref</code> has the two components: the first one is
the reference average, and the second one is the reference standard
deviation.</p>
</div>
</div>
<div class="section level4">
<h4 id="gap-filling">Gap-filling<a class="anchor" aria-label="anchor" href="#gap-filling"></a>
</h4>
<p><code><a href="../reference/fill_gaps.html">fill_gaps()</a></code> replaces all missing values in a target time
series with values estimated by a random forest model. The
hyperparameter calibration process is the same as that of the random
forest outlier removal. After determining the optimal hyperparameters,
they are used to construct the optimal random forest model. Predicted
time series are equal to average from 500 (default; specified by
<code>n_tree</code>) tree outputs at each time point. If the input
targeted value is missing, the predicted value is used for the
imputation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fill all the missing values by the random forest model</span></span>
<span><span class="va">df_gf</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/fill_gaps.html">fill_gaps</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_all</span>,</span>
<span>            colname_label <span class="op">=</span> <span class="st">"z_rf"</span>,</span>
<span>            vctr_colname_feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>, <span class="st">"sw_in"</span>, <span class="st">"ta"</span>, <span class="st">"vpd"</span>, <span class="st">"ws"</span>, <span class="st">"swc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>z_gf <span class="op">=</span> <span class="va">df_gf</span><span class="op">$</span><span class="va">stats</span><span class="op">$</span><span class="va">gapfilled</span><span class="op">)</span></span></code></pre></div>
<p>The column <code>z_gf</code> in the <code>df_all</code> data frame
represents the gap-filled standardized
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series.</p>
</div>
<div class="section level4">
<h4 id="time-series-retrieval">Time series retrieval<a class="anchor" aria-label="anchor" href="#time-series-retrieval"></a>
</h4>
<p><code><a href="../reference/retrieve_ts.html">retrieve_ts()</a></code> converts the standardized Z-score time
series into a time series in its original units. This retrieval is
performed by multiplying the Z-score by the standard deviation and
adding the average. If the average and standard deviation time series
are the same as those in converting the original time series into the
Z-score time series, the original values with the original average and
standard deviation are retrieved. If reference values of the average
and/or standard deviation are used, the output time series are detrended
and/or applied to signal damping correction.</p>
<p>For the sample data process, detrending is needed. So, you set
<code>detrend</code> as <code>TRUE</code>, input the reference average
calculated by <code><a href="../reference/calc_ref_stats.html">calc_ref_stats()</a></code> into <code>avg_ref</code>,
and let <code>correct_damping</code> remain <code>FALSE</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Retrieve the time series in its original units</span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dt_processed <span class="op">=</span> <span class="fu"><a href="../reference/retrieve_ts.html">retrieve_ts</a></span><span class="op">(</span>vctr_target_z <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">z_gf</span>,</span>
<span>                                           vctr_target_sd <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">sd_cleaned</span>,</span>
<span>                                           detrend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                           avg_ref <span class="op">=</span> <span class="va">vctr_stats_ref</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The column <code>dt_processed</code> represents the
quality-controlled
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
time series, and the same as the output time series by
<code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> in the previous section. Well done!</p>
<p>In the following parts, you will learn the processes specific to
thermal dissipation sap flow data.</p>
</div>
<div class="section level4">
<h4 id="zero-flow-conditions-determination">Zero-flow conditions determination<a class="anchor" aria-label="anchor" href="#zero-flow-conditions-determination"></a>
</h4>
<p><code><a href="../reference/calc_dtmax.html">calc_dtmax()</a></code> provides multiple
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
time series estimated by different methods below:</p>
<ul>
<li><p>The successive predawn (SP) method defines the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
for a day as the maximum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
within a 24-hour period that begins at 5:00 a.m. (default; just before
daybreak in temperate zones and specified by
<code>thres_hour_sp</code>). In other words, the day starts at predawn,
not midnight, and the maximum value for that period is assumed to be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>.
This method has the advantage of being able to calculate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
quickly while minimizing the effect of nocturnal transpiration on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
estimation.</p></li>
<li><p>The daily predawn (PD) method defines the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
for a day as the maximum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
between midnight and the morning (8:00 a.m. in local time, specified by
<code>thres_hour_pd</code>) when the global solar radiation is below the
threshold value, specified by <code>thres_radi</code>. See more details
in <a href="https://doi.org/10.1111/nph.15241" class="external-link">Peters et
al. (2018)</a>.</p></li>
<li><p>The moving window (MW) method selects the maximum value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>,
estimated by the PD method, using a moving window with an eleven-day
length (default; specified by <code>wndw_size_dtmax</code>). The
selected
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
is considered to be the final
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>.
See more details in <a href="https://doi.org/10.1111/nph.15241" class="external-link">Peters
et al. (2018)</a>.</p></li>
<li><p>The double regression (DR) method first calculates the moving
window mean value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>,
estimated by the PD method, with an eleven-day length (default;
specified by <code>wndw_size_dtmax</code>). The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
that is lower than the mean is omitted, and then the moving window mean
is recalculated as the final
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>.
See more details in <a href="https://doi.org/10.1111/nph.15241" class="external-link">Peters
et al. (2018)</a>.</p></li>
<li><p>The environmental dependent (ED) method filters the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>,
estimated by the PD method, using the environmental conditions when
plants let their sap flow nearly zero. A stable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>,
with a low coefficient of variation, and low air temperature or vapor
pressure deficit over a two-hour period, characterizes these zero-flow
conditions. The threshold values can be changed by
<code>thres_cv</code>, <code>thres_ta</code>, and <code>thres_vpd</code>
arguments. See more details in <a href="https://doi.org/10.1016/j.softx.2016.07.003" class="external-link">Oishi et
al. (2016)</a> and <a href="https://doi.org/10.1111/nph.15241" class="external-link">Peters et
al. (2018)</a>. After the filtering, the daily
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
is interpolated if necessary.</p></li>
</ul>
<p>By default, <code><a href="../reference/calc_dtmax.html">calc_dtmax()</a></code> only outputs
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
time series by the SP method. You can select any combination of the
methods by specifying <code>method</code>, such as
<code>method = c("sp", "pd")</code>. Make sure you indicate the vectors
of the meteorological variables required for the selected methods into
<code>vctr_radi</code>, <code>vctr_ta</code>, and <code>vctr_vpd</code>
arguments. See the table in the “Data preparation” section to check
which variables are needed for each method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate dTmax by the SP and PD methods</span></span>
<span><span class="va">df_dtmax</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/calc_dtmax.html">calc_dtmax</a></span><span class="op">(</span>vctr_time <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">time</span>,</span>
<span>             vctr_dt <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">dt_processed</span>,</span>
<span>             vctr_radi <span class="op">=</span> <span class="va">df_all</span><span class="op">$</span><span class="va">sw_in</span>,</span>
<span>             method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="st">"pd"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_dtmax</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dtmax_sp</span>, <span class="va">dtmax_pd</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">df_all</span>, <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>The columns <code>dtmax_sp</code> and <code>dtmax_pd</code> represent
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
time series calculated by the SP and PD method, respectively.</p>
</div>
<div class="section level4">
<h4 id="sap-flux-density-calculation">Sap flux density calculation<a class="anchor" aria-label="anchor" href="#sap-flux-density-calculation"></a>
</h4>
<p>This is the final step. <code><a href="../reference/calc_fd.html">calc_fd()</a></code> calculates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi mathvariant="normal">d</mi></msub><annotation encoding="application/x-tex">F_\mathrm{d}</annotation></semantics></math>
(sap flux density) time series, including heartwood correction.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi mathvariant="normal">d</mi></msub><annotation encoding="application/x-tex">F_\mathrm{d}</annotation></semantics></math>
is estimated using a power-type function introduced by Granier (<a href="http://doi.org/10.1051/forest:19850204" class="external-link">1985</a>, <a href="http://doi.org/10.1093/treephys/3.4.309" class="external-link">1987</a>). First, a
dimensionless index K is obtained from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>.
Second, K is raised to the power <code>beta</code> and then multiplied
by <code>alpha</code>, obtaining
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi mathvariant="normal">d</mi></msub><annotation encoding="application/x-tex">F_\mathrm{d}</annotation></semantics></math>.</p>
<p>If the sapwood width is shorter than the probe insertion length,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
can be overestimated, resulting in an underestimation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi mathvariant="normal">d</mi></msub><annotation encoding="application/x-tex">F_\mathrm{d}</annotation></semantics></math>.
Therefore, heartwood correction is required to correct
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>.
Optionally, before calculating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi mathvariant="normal">d</mi></msub><annotation encoding="application/x-tex">F_\mathrm{d}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
can be replaced with the corrected
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
by specifying the ratio of the probe length to sapwood width. This
correction assumes that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\Delta T</annotation></semantics></math>
measured by the part of the probe that is inserted into the heartwood is
always
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>.
See more details in <a href="http://doi.org/10.1093/treephys/19.10.681" class="external-link">Clearwater et
al. (1999)</a>.</p>
<p>For the sample data process, there is no need to do the heartwood
correction. So, you let <code>do_heartwood_correction</code> remain
<code>FALSE</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate Fd using the dTmax estimated by the SP and PD methods</span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fd_sp <span class="op">=</span> <span class="fu"><a href="../reference/calc_fd.html">calc_fd</a></span><span class="op">(</span>vctr_dt <span class="op">=</span> <span class="va">dt_processed</span>,</span>
<span>                                vctr_dtmax <span class="op">=</span> <span class="va">dtmax_sp</span><span class="op">)</span>,</span>
<span>                fd_pd <span class="op">=</span> <span class="fu"><a href="../reference/calc_fd.html">calc_fd</a></span><span class="op">(</span>vctr_dt <span class="op">=</span> <span class="va">dt_processed</span>,</span>
<span>                                vctr_dtmax <span class="op">=</span> <span class="va">dtmax_pd</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The columns <code>fd_sp</code> and <code>fd_pd</code> represent the
calculated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mi mathvariant="normal">d</mi></msub><annotation encoding="application/x-tex">F_\mathrm{d}</annotation></semantics></math>
time series using the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><msub><mi>T</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta T_\mathrm{max}</annotation></semantics></math>
estimated by the SP and PD method, respectively.</p>
<p>Congratulations! Now you can use these functions and
<code><a href="../reference/run_fluxfixer.html">run_fluxfixer()</a></code> more appropriately and flexibly. I hope the
fluxfixer will make your data quality control tasks less painful.</p>
<p>If you have any questions, please check each function’s help page
first, then feel free to contact me.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yoshiaki Hata.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
