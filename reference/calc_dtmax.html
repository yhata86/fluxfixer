<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate dTmax by various methods — calc_dtmax • fluxfixer</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate dTmax by various methods — calc_dtmax"><meta name="description" content="`calc_dtmax()` calculates the time series of dTmax (the maximum
 temperature difference between sap flow probes under zero-flow conditions)
 using multiple methods."><meta property="og:description" content="`calc_dtmax()` calculates the time series of dTmax (the maximum
 temperature difference between sap flow probes under zero-flow conditions)
 using multiple methods."><meta property="og:image" content="https://yhata86.github.io/fluxfixer/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fluxfixer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/fluxfixer.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yhata86/fluxfixer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate dTmax by various methods</h1>
      <small class="dont-index">Source: <a href="https://github.com/yhata86/fluxfixer/blob/v1.0.0/R/calc_dtmax.R" class="external-link"><code>R/calc_dtmax.R</code></a></small>
      <div class="d-none name"><code>calc_dtmax.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>`calc_dtmax()` calculates the time series of dTmax (the maximum
 temperature difference between sap flow probes under zero-flow conditions)
 using multiple methods.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_dtmax</span><span class="op">(</span></span>
<span>  <span class="va">vctr_time</span>,</span>
<span>  <span class="va">vctr_dt</span>,</span>
<span>  vctr_radi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vctr_ta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vctr_vpd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp"</span><span class="op">)</span>,</span>
<span>  thres_hour_sp <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  thres_radi <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  thres_ta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  thres_vpd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  thres_cv <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  thres_hour_pd <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  min_n_wndw_dtmax <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  wndw_size_dtmax <span class="op">=</span> <span class="fl">11</span>,</span>
<span>  output_daily <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-vctr-time">vctr_time<a class="anchor" aria-label="anchor" href="#arg-vctr-time"></a></dt>
<dd><p>A timestamp vector of class POSIXct or POSIXt. This vector
indicates the timings of the end of each measurement in local time. Any
interval (typically 15 to 60 min) is allowed, but the timestamps must be
equally spaced and arranged chronologically.</p></dd>


<dt id="arg-vctr-dt">vctr_dt<a class="anchor" aria-label="anchor" href="#arg-vctr-dt"></a></dt>
<dd><p>A vector of dT (the temperature difference between sap flow
probes, in degrees Celsius) time series. The length of the vector must
match that of the timestamp vector. Missing values must be gap-filled
previously.</p></dd>


<dt id="arg-vctr-radi">vctr_radi<a class="anchor" aria-label="anchor" href="#arg-vctr-radi"></a></dt>
<dd><p>A vector of global solar radiation or a similar radiative
variable time series. Default is `NULL`, but this vector must be provided
when `method` includes `pd`, `mw`, `dr`, or `ed`. The length of the vector
must match that of the timestamp vector. Missing values must be gap-filled
previously. The unit of the time series must match that of `thres_radi`.</p></dd>


<dt id="arg-vctr-ta">vctr_ta<a class="anchor" aria-label="anchor" href="#arg-vctr-ta"></a></dt>
<dd><p>A vector of air temperature (degrees Celsius) time series.
Default is `NULL`, but this vector must be provided when `method` includes
`ed`. The length of the vector must match that of the timestamp vector.
Missing values must be gap-filled previously. The unit of the time series
must match that of `thres_ta`.</p></dd>


<dt id="arg-vctr-vpd">vctr_vpd<a class="anchor" aria-label="anchor" href="#arg-vctr-vpd"></a></dt>
<dd><p>A vector of vapor pressure deficit (VPD, in hPa) time
series. Default is `NULL`, but this vector must be provided when `method`
includes `ed`. The length of the vector must match that of the timestamp
vector. Missing values must be gap-filled previously. The unit of the time
series must match that of `thres_vpd`.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>A vector of characters indicating the dTmax estimation
methods. "sp", "pd", "mw", "dr", and "ed" represent the successive predawn,
daily predawn, moving window, double regression, and environmental
dependent method, respectively. Default is
`c("sp")`.</p></dd>


<dt id="arg-thres-hour-sp">thres_hour_sp<a class="anchor" aria-label="anchor" href="#arg-thres-hour-sp"></a></dt>
<dd><p>An integer from 0 to 23. The threshold hour of the day
which defines the start of predawn in local time (default is 5).</p></dd>


<dt id="arg-thres-radi">thres_radi<a class="anchor" aria-label="anchor" href="#arg-thres-radi"></a></dt>
<dd><p>A threshold value of the radiation to define daytime.
Default is 100 (W m-2). The data points with radiation values above the
threshold are considered daytime values. The unit of the threshold must
match that of the input radiation time series.</p></dd>


<dt id="arg-thres-ta">thres_ta<a class="anchor" aria-label="anchor" href="#arg-thres-ta"></a></dt>
<dd><p>A threshold value of the air temperature to define predawn.
Default is 1.0 (degrees Celsius). The dTmax, estimated by the PD method,
with air temperature values below the threshold, is selected as a candidate
for the final dTmax. The unit of the threshold must match that of the input
air temperature time series.</p></dd>


<dt id="arg-thres-vpd">thres_vpd<a class="anchor" aria-label="anchor" href="#arg-thres-vpd"></a></dt>
<dd><p>A threshold value of the VPD to define predawn. Default is
1.0 (hPa). The dTmax, estimated by the PD method, with VPD values below the
threshold, is selected as a candidate for the final dTmax. The unit of the
threshold must match that of the input VPD time series.</p></dd>


<dt id="arg-thres-cv">thres_cv<a class="anchor" aria-label="anchor" href="#arg-thres-cv"></a></dt>
<dd><p>A threshold value of the coefficient of variation (CV) to
define predawn. Default is 0.005. The dTmax, estimated by the PD method,
with CV values below the threshold, is selected as a candidate for the
final dTmax.</p></dd>


<dt id="arg-thres-hour-pd">thres_hour_pd<a class="anchor" aria-label="anchor" href="#arg-thres-hour-pd"></a></dt>
<dd><p>An integer from 0 to 23. The threshold hour of the day
which defines the end of predawn in local time (default is 8).</p></dd>


<dt id="arg-min-n-wndw-dtmax">min_n_wndw_dtmax<a class="anchor" aria-label="anchor" href="#arg-min-n-wndw-dtmax"></a></dt>
<dd><p>A positive integer indicating the minimum number of
data points for calculating statistics using a moving window (default is
3). If the number of data points is less than this threshold, the
statistics are not calculated in the window.</p></dd>


<dt id="arg-wndw-size-dtmax">wndw_size_dtmax<a class="anchor" aria-label="anchor" href="#arg-wndw-size-dtmax"></a></dt>
<dd><p>A positive integer indicating the window size (days)
for determining moving window maximum values of dTmax. Default is 11
(days).</p></dd>


<dt id="arg-output-daily">output_daily<a class="anchor" aria-label="anchor" href="#arg-output-daily"></a></dt>
<dd><p>A boolean. If `TRUE`, returns dTmax time series in daily
steps; else, returns dTmax in the original time steps. Default is `FALSE`.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with columns below:</p>
<p>* The first column, `time`, gives the timestamp of the measurements. If
 `output_daily` is `FALSE` (default), this column is the same as the input
 timestamp, `vctr_time`. If `output_daily` is `TRUE`, the timestamp in daily
 steps is returned.</p>
<p>* The second column, `dt`, gives the input dT time series. If `output_daily`
 is `TRUE`, dT is returned in daily steps. If `output_daily` is `FALSE`
 (default), this column is not output.</p>
<p>* The other columns, which have the prefix "dtmax_", provide the dTmax
 calculated by the methods specified in `method`. The last two letters of
 the column name represent the name of the dTmax estimation method. "sp",
 "pd", "mw", "dr", and "ed" represent the successive predawn, daily predawn,
 moving window, double regression, and environmental dependent method,
 respectively. If `output_daily` is `FALSE` (default), this column has the
 same time step as the input timestamp. If `output_daily` is `TRUE`, the
 dTmax is returned in daily steps."</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function provides multiple dTmax time series estimated by
 different methods below:</p>
<p>* The successive predawn (SP) method defines the dTmax for a day as the
  maximum dT (the temperature difference between sap flow probes) within a
  24-hour period that begins at 5:00 a.m. (default; just before daybreak in
  temperate zones). In other words, the day starts at predawn, not midnight,
  and the maximum value for that period is assumed to be dTmax. This method
  has the advantage of being able to calculate dTmax quickly while
  minimizing the effect of nocturnal transpiration on dTmax estimation.</p>
<p>* The daily predawn (PD) method defines the dTmax for a day as the maximum
  dT between midnight and the morning (8:00 a.m. in local time) when the
  global solar radiation is below the threshold value (100 W m-2). See more
  details in Peters et al. (2018; New Phytologist).</p>
<p>* The moving window (MW) method selects the maximum value of dTmax,
  estimated by the daily predawn method, using a moving window with an
  eleven-day length. The selected dTmax is considered to be the final dTmax.
  See more details in Peters et al. (2018; New Phytologist).</p>
<p>* The double regression (DR) method first calculates the moving window mean
  value of dTmax, estimated by the daily predawn method, with an eleven-day
  length. The dTmax that is lower than the mean is omitted, and then the
  moving window mean is recalculated as the final dTmax. See more details in
  Peters et al. (2018; New Phytologist).</p>
<p>* The environmental dependent (ED) method filters the dTmax, estimated by
  the daily predawn method, using the environmental conditions when plants
  let their sap flow nearly zero. A stable dT, with a low coefficient of
  variation, and low air temperature or vapor pressure deficit over a
  two-hour period, characterizes these zero-flow conditions. See more
  details in Oishi et al. (2016; SoftwareX) and Peters et al. (2018; New
  Phytologist). After the filtering, the daily dTmax is interpolated if
  necessary.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Load data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dt_gf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">dt_gf</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">480</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">dt_gf</span><span class="op">$</span><span class="va">dt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">480</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">radi</span> <span class="op">&lt;-</span> <span class="va">dt_gf</span><span class="op">$</span><span class="va">sw_in</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">480</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ta</span> <span class="op">&lt;-</span> <span class="va">dt_gf</span><span class="op">$</span><span class="va">ta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">480</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">vpd</span> <span class="op">&lt;-</span> <span class="va">dt_gf</span><span class="op">$</span><span class="va">vpd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">480</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate dTmax from gap-filled dT time series</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span> <span class="fu">calc_dtmax</span><span class="op">(</span>vctr_time <span class="op">=</span> <span class="va">time</span>, vctr_dt <span class="op">=</span> <span class="va">dt</span>, vctr_radi <span class="op">=</span> <span class="va">radi</span>, vctr_ta <span class="op">=</span> <span class="va">ta</span>,</span></span>
<span class="r-in"><span>            vctr_vpd <span class="op">=</span> <span class="va">vpd</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="st">"pd"</span>, <span class="st">"mw"</span>, <span class="st">"dr"</span>, <span class="st">"ed"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            thres_vpd <span class="op">=</span> <span class="fl">6.0</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Zero-flow condition estimation started</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax calculation by the SP method started</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax calculation by the SP method finished</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax calculation by the PD and ED methods started</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |========                                                              |  11%  |                                                                              |================                                                      |  22%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================                                       |  44%  |                                                                              |=======================================                               |  56%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================                |  78%  |                                                                              |==============================================================        |  89%  |                                                                              |======================================================================| 100%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax calculation by the PD and ED methods finished</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax calculation by the MW and DR methods started</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |========                                                              |  11%  |                                                                              |================                                                      |  22%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================                                       |  44%  |                                                                              |=======================================                               |  56%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================                |  78%  |                                                                              |==============================================================        |  89%  |                                                                              |======================================================================| 100%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax calculation by the MW and DR methods finished</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax time series aggregation started</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- dTmax time series aggregation finished</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Zero-flow condition estimation finished</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yoshiaki Hata.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

